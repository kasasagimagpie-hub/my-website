<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>〇×ゲーム</title>
<style>
  .board { 
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    width: 300px;
    height: 300px;
    margin-bottom: 20px;
  }
  .cell {
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid #000;
    font-size: 2em;
    cursor: pointer;
  }
  #fireworksCanvas {
    display: none;
    background: black;
  }
</style>
</head>
<body>

<h2>〇×ゲーム</h2>

<div class="board">
  <div class="cell"></div>
  <div class="cell"></div>
  <div class="cell"></div>
  <div class="cell"></div>
  <div class="cell"></div>
  <div class="cell"></div>
  <div class="cell"></div>
  <div class="cell"></div>
  <div class="cell"></div>
</div>

<canvas id="fireworksCanvas" width="300" height="300"></canvas>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const cells = document.querySelectorAll('.cell');
  const canvas = document.getElementById('fireworksCanvas');
  const ctx = canvas.getContext('2d');
  let currentPlayer = 'X';
  let gameOver = false;

  const winPatterns = [
    [0,1,2],[3,4,5],[6,7,8], // rows
    [0,3,6],[1,4,7],[2,5,8], // columns
    [0,4,8],[2,4,6]          // diagonals
  ];

  cells.forEach((cell, index) => {
    cell.addEventListener('click', function() {
      if (cell.textContent === '' && !gameOver) {
        cell.textContent = currentPlayer;

        if (checkWin(currentPlayer)) {
          gameOver = true;
          showFireworks();
          return;
        }

        currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
      }
    });
  });

  function checkWin(player) {
    return winPatterns.some(pattern =>
      pattern.every(i => cells[i].textContent === player)
    );
  }

  /* ----- 花火アニメーション ----- */
  function showFireworks() {
    canvas.style.display = 'block';

    const particles = [];
    const colors = ["red","yellow","blue","white","lime","orange","pink","aqua"];

    function createFirework() {
      const x = Math.random() * canvas.width;
      const y = Math.random() * canvas.height / 2;
      const color = colors[Math.floor(Math.random() * colors.length)];

      for (let i = 0; i < 50; i++) {
        particles.push({
          x: x,
          y: y,
          vx: Math.cos((Math.PI * 2) * (i / 50)) * (Math.random()*3+2),
          vy: Math.sin((Math.PI * 2) * (i / 50)) * (Math.random()*3+2),
          alpha: 1,
          color: color
        });
      }
    }

    function animate() {
      ctx.fillStyle = "rgba(0,0,0,0.2)";
      ctx.fillRect(0,0,canvas.width,canvas.height);

      particles.forEach((p, i) => {
        p.x += p.vx;
        p.y += p.vy;
        p.alpha -= 0.02;

        if (p.alpha <= 0) {
          particles.splice(i, 1);
        } else {
          ctx.fillStyle = `rgba(${p.color === 'white' ? "255,255,255" : ""},${p.color === 'red' ? "255,0,0" : ""},1)`;
          ctx.globalAlpha = p.alpha;
          ctx.beginPath();
          ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
          ctx.fillStyle = p.color;
          ctx.fill();
        }
      });
      ctx.globalAlpha = 1;

      if (Math.random() < 0.05) createFirework();

      if (gameOver) requestAnimationFrame(animate);
    }

    createFirework();
    animate();
  }
});
</script>

</body>
</html>
